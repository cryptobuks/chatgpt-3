Presenter-B:  Enable private Google access to allow private connectivity from a VPC on PREM Network to Google, APIs and Services. Basically this slash dirty range that I have on the screen, it's a Private, not announced to the Internet Google Network.
Presenter-B:  That basically stays within the Google networks when you're sending traffic to it. So because of this you can control What? IPS your Google services are accessible from. If any of you are familiar with AWS, this is very similar to VPC endpoints where you could create an endpoint within your VPC network. That exposed a particular service, it works in a similar way, you basically keep your API traffic private and you don't send it out to the public Internet where it will get routed to Google.
Presenter-B:  Next up, that's something I discovered when I was actually deploying VPC service controls for a client. If you have a shared VPC, host project, Ideally, it should not be power part of a perimeter. Mostly because a shared VPC, host project will probably have multiple shared Vpcs in it. and once a project is part of a VP's VPC service controls perimeter, it can only be part of one parameter, not part of multiple parameters. And any VPC network that's part of a parameter will retain its protections. So let's say, you know, I have this host project out there and I have multiple Vpcs shared to each perimeter. Uh, if I were to make The host project. Part of a perimeter, I would not be able to share those Vpcs to other parameters.
00:50:00
Presenter-B:  it just isn't allowed if I don't make the host project power of a perimeter, I can then take those shared vpcs and make them part of Individual parameters. That way, any resources that run on those vpcs will have protections defined by the perimeter that they're attached to you know, I typically in a host project you really don't have anything running, you really shouldn't have any resources running on it other than you know your hosts in your shared VPC so I think it makes sense not to have it part of a perimeter but you know, definitely make those bpcs part of parameters and actually Google has a page on including VPC networks in a service parameters and they have Additional.
Presenter-B:  Gushes as well you know you can definitely add PPC networks and host projects to the same parameter. It's just those VPC networks will not be able to be part of different parameters. Um, and you know, in our client engagement, you know, we had one host projects, host project with multiple vpcs. We had to take it out of a perimeter because those vpcs needed to be part of different parameters.
Presenter-B: Next up, Locking down services for users. Can have hilarious resort results if you log down, you know, Google Cloud Storage servers and you don't specify any access levels if I go to Google Cloud storage in. the Cloud Console, I will not be able to see my buckets because My user session for the Cloud. Console is coming from a public IP from my workstation. We're not allowing my workstation as part of access level, therefore, I will not be able to see any buckets within that perimeter. And that goes for any service.
Presenter-B:  So when you create a perimeters, especially when you first start off with VPC service controls, I recommend that you add your workstations IP to an access level. So that way, you don't get locked out. And I spent a lot of hours trying to figure out why I couldn't see, you know, my cloud storage buckets until I realized that my IPv6 address kept changing every couple hours and I'll keep getting locked out. So, I ended up having to add aesthetic, mapping in my router to add, You know, to make sure that I have a static IPv6 address. Otherwise, I'll have to add, You know, my slash 64 IPv6 prefix to an access level. And by the way access levels, do support, IPv4 and IPv6 UBC price. Actually how much IPv6 is used these days especially with the Cloud console, and Cloud APIs.
Presenter-B:  Next up ipll list where I just referenced ingress and rigorous rules something I mentioned before, as well, when you're writing power form, and you're ingress and ingress rules, and terraform, make sure you use the equal signs versus the columns. I've had numerous mistakes where I mix them up and I spent too much time debugging stupid colons. Lastly used trb to double. Check your sanity. I haven't done it as part of my past engagement and I regret it I think they could have saved me some time. But used trb have them double, check your sanity. And, you know, learn from my mistakes VPC, service controls can be annoying. But once they're understood, they're not that hard to implement.
Presenter-B:  Uh, demo. So if you guys have time to hang out after this call, our after, you know, this time, I'm going to do to demos where I'm going to create a perimeter and protect GCs, and I'll try and access data from inside of the perimeter and from outside of the perimeter, And then, you know, I'll add inbound and outbound egress rules to provide access. And later on all should show, top form and how to do this using terraform. Google actually has a Module that you can use to. Create and manage service controls. In fact, I had to create a full request with a bug fix to that module yesterday. Because as it turns out, they support adding projects as part of a perimeter.
00:55:00
Presenter-B:  They didn't support adding Vpcs. Even though the API for Access Context Manager, actually supports it.
Presenter-B:  Ah, yeah. So if I go to like the service permits overview, you know, you specify your resources that you want to
Presenter-B:  Protect and, you know, you can protect projects and vpcs at this point. Anyway. Are you guys ready for a demo? Do you guys have time to hang out for a couple more minutes? All right, cool.
Jimmy Cui: Yeah, let's continue. You know you first saw my kind of make it we'll share the recording session. Let's go.
Presenter-B:  Cool, awesome. All right, let me make sure Mike Entire screen.
Presenter-B:  All right. Make it a little bigger. So VPC service controls are on organization resource, you will manage them from your organization console
Presenter-B: You have numerous modes and force try mode, I'll focus on andâ€¦
Miguel Izaga: Up.
Presenter-B: enforce mode, for the sake of time. I'm going to create a perimeter called protective perimeter. Will make it regular perimeter, we'll select a project that I want to protect.
Presenter-B:  I'll select the VPC network that will allow access from the perimeter. Talk to that perimeter. Gotta find my shared VPC network.
Presenter-B:  Next up also like services, I want to protect Google right away recommends that you protect storage services, you'll even see it here.
Presenter-B: Mostly, because that's the best. That's the most likely to get data exfiltration happen to you. This, you know, buckets are pain in the butt to protect, especially when you start growing insights, and you start having multiple identities start to access them. VPC Accessible services. So you can control which services can access the which services are accessible using the private Google access. That is that slash dirty network with the private Non-routable, addresses that are private to Google Network. Ah, by default. I just select all services. Access levels. You can specify which axis level will be, you know, we'll have access. so, any external Resources. English Policies in English Policies For now. I'll leave blank. Just to show you what happens when I protect the service using a perimeter.
Presenter-B:  so, one of my projects that protected in my perimeter, I have a bucket and you'll see that. Well, right now I can still actually that's the wrong bucket.
Presenter-B:  That's the right bucket.
Presenter-B:  I should shortly get the night access. Yeah. There we go. Sorry. The server was not able to fulfill your request. Why is that? Well, that's because I did not add an access level. So I'm not allowing my laptop, my workstation to get to it. So I'm going to create an access level, and I'll allow my IP address. Let's see. IPv4.
Presenter-B:  There's also I'm going to add IPv6.
Presenter-B:  Okay. We can also specify what cloud identities can. Access this as well as GEO locations. um, see
Presenter-B:  So yeah, you can also like specify your cloud identity. So for example, You only want users from your organization to be able to browse through your resources in the Cloud console? You can specify their user IDs or service accounts in here as well. In case you don't want to be using, you know, IP cider ranges. For example, in case it becomes a pain to manage since a lot of users may have the ACP addresses or dynamic addresses. Anyway. Let's go back to our perimeter, let's specify an excess level.
Presenter-B:  We'll save it. perimeter update can take up to five minutes to or sometimes even up to 30 minutes to Update. I've seen it that typically updates within like the five minute period. Sometimes even quicker go back to our bucket, refresh. And we should be able to See the bucket resources real quick. Yep. So we have this file that sits on the bucket. Now, let's try and access this file from our
01:00:00
Presenter-B:  Perimeter. So up here, I have an instance in one of the projects that are part of the perimeter. You'll see that I can copy data from that bucket but I will not be able to copy data outside of this bucket.
Presenter-B:  So that works. Now, let's see. Let's copy data from this bucket to a bucket outside of the perimeter.
Presenter-B: And you'll see that our axis is denied because I'm haven't defined any egress rows to allow access to, you know, from my permit to another outside of outside outside perimeter. So, if I go back to my instance,
Presenter-B:  I'm gonna copy, it's service account.
Presenter-B:  And I'm going to go back to our Through the mirrors. I'm going to add an egress rule that says, Hey, this guy can
Presenter-B:  copy stuff. And we can specify which projects we can talk to so this gives us a granular way of control of what identity can copy data from my perimeter to another project.
Presenter-B:  Like this. Let's make sure.
Presenter-B:  Okay, services. We can specify that. I can only talk to storage API. We're going to save this and hopefully within a couple seconds. Our copy command will work. And like I said, sometimes it takes a couple minutes eventual consistency.
Presenter-B:  Let's see. There we go. It's looks like it's starting to get some API access Because it was able to look up the object. And there we go. It took us maybe 20 to 30 seconds, but we were able to finally copy data, from perimeter, bucket to a bucket outside of the perimeter. Now, let's say I have a resource on the outside of perimeter, this instance on the bottom, it's in one of my projects that's outside of a perimeter. Let's say I want to copy buckets from a perimeter or you know, data from a perimeter.
Presenter-B:  And that should fail, and that's because we need and One sec.
Presenter-B:  And in this case, we'll need an egret ingress rule to allow an outside identity to get inside of this perimeter. So, I'm going to go to my second instance and pull up. It's service account. And this instance is outside of my perimeter and I want to be able to talk to my parameters API to get resources from its protected bucket. So once again, let's go back to our perimeter.
Presenter-B:  Create an ingress policy. Will specify our service account.
Presenter-B:  Project will specify that it's coming from our outside project.
Presenter-B:  And we can also specify a source in Ibpc network.
Presenter-B:  If we wanted to,
Presenter-B: and we can specify, you know,
Presenter-B:  Projects. Services. We only want care about cloud storage right now. Click Save. Hopefully. We'll be able to copy it bucket. You know, bucket data from our perimeter, to an instance, outside of our perimeter because we just edit the ingress rule.
