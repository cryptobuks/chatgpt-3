# This is a GitHub action workflow that uses curl to call OpenAI API
# and generate a speaking script from an input in a local text file
# and show the script in the next step

name: Fake Video Generator

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the main branch
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
jobs:
  chatgpt:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Call chatgpt API
        id: chatgpt
        run: |
          RESPONSE_GPT=$(curl --location --insecure --request POST 'https://api.openai.com/v1/chat/completions' \
            --header "Authorization: Bearer ${{ secrets.OPENAI_API_KEY }}" \
            --header 'Content-Type: application/json' \
            -d @chatgpt_pmt2.json) | jq '.choices[0].message.content'
          echo "response:$RESPONSE_GPT"
          echo "response=$RESPONSE_GPT" >> $GITHUB_OUTPUT


      - name: Show speaking script
        run: |
          echo "output: ${{ steps.chatgpt.outputs.response }}"
          echo "output.body ${{ steps.chatgpt.outputs.body }}"
